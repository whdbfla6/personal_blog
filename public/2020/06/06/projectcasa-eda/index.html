<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.72.0" />


<title>projectCASA_EDA - A Hugo website</title>
<meta property="og:title" content="projectCASA_EDA - A Hugo website">


  <link href='/favicon.ico' rel='icon' type='image/x-icon'/>



  








<link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css' rel='stylesheet' type='text/css' />



<link rel="stylesheet" href="/css/fonts.css" media="all">
<link rel="stylesheet" href="/css/main.css" media="all">



  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="/" class="nav-logo">
    <img src="/images/logo.png"
         width="50"
         height="50"
         alt="Logo">
  </a>

  <ul class="nav-links">
    
    <li><a href="/about/">About</a></li>
    
    <li><a href="https://github.com/rstudio/blogdown">GitHub</a></li>
    
    <li><a href="https://instagram.com/yoorim077">instagram</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">5 min read</span>
    

    <h1 class="article-title">projectCASA_EDA</h1>

    
    <span class="article-date">2020-06-06</span>
    

    <div class="article-content">
      


<div id="들어가며" class="section level4">
<h4>0. 들어가며</h4>
<ul>
<li>이 게시글은 서울 아파트 실거래가 예측 시스템을 구축하는 프로젝트에서 EDA파트를 담고 있다.</li>
</ul>
</div>
<div id="eda에-필요한-라이브러리" class="section level4">
<h4>1. EDA에 필요한 라이브러리</h4>
<pre class="python"><code>import pandas as pd
import json
import psycopg2
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

%matplotlib inline

import warnings
warnings.filterwarnings(&#39;ignore&#39;)</code></pre>
</div>
<div id="데이터프레임-불러오기" class="section level4">
<h4>2. 데이터프레임 불러오기</h4>
<pre class="python"><code>def call_df(table_name):
    with open(&#39;config.json&#39;, &#39;r&#39;) as f:
        config = json.load(f)
        
    conn = psycopg2.connect(user = config[&#39;USER&#39;],
                              password = config[&#39;PASSWORD&#39;],
                              host = config[&#39;HOST&#39;],
                              port = config[&#39;PORT&#39;],
                              database = config[&#39;DATABASE&#39;])
    
    sql = f&#39;SELECT * FROM {table_name}&#39;
    df = pd.read_sql_query(sql, conn)
    conn.close()
    return df</code></pre>
<pre class="python"><code>district = call_df(&#39;crawling_db.district_table&#39;)
apartment = call_df(&#39;crawling_db.apartment_table&#39;).drop(columns=&#39;table_id&#39;)
school = call_df(&#39;crawling_db.school_table&#39;).drop(columns=&#39;table_id&#39;)
price = call_df(&#39;crawling_db.price_table&#39;)
subway = call_df(&#39;crawling_db.subway_table&#39;).drop(columns=&#39;table_id&#39;)</code></pre>
<pre class="python"><code>df = (price.merge(apartment, how=&#39;left&#39;, on=&#39;apartment_id&#39;).
      merge(district, how=&#39;left&#39;, on=&#39;district_id&#39;).
      merge(school, how=&#39;left&#39;, on=&#39;apartment_id&#39;).
      merge(subway, how=&#39;left&#39;, on=&#39;apartment_id&#39;))</code></pre>
</div>
<div id="데이터-분석을-위한-기본적인-데이터-전처리" class="section level4">
<h4>3. 데이터 분석을 위한 기본적인 데이터 전처리</h4>
<div id="분석에-용이하도록-object-변수-변환" class="section level5">
<h5>1) 분석에 용이하도록 Object 변수 변환</h5>
<pre class="python"><code># school_Students를 숫자형 변수로 바꿔준다
df[&#39;school_students&#39;] = pd.to_numeric(df[&#39;school_students&#39;])</code></pre>
<pre class="python"><code># area에서 숫자가 아닌 부분을 제거해준다 
import re
df[&#39;area&#39;] = df[&#39;area&#39;].apply(lambda x: int(re.split(&#39;\D&#39;,x)[0]))</code></pre>
<pre class="python"><code>#&#39;school_addr_town&#39;에서 ~길의 내용을 제거하고 ~로까지 확인한다 
import re
df[&#39;school_addr_town&#39;] = df[&#39;school_addr_town&#39;].apply(lambda x: re.split(&#39;\d&#39;,x)[0])

# chool_addr_town&#39;에서 &#39;로&#39; 를 &#39;동&#39;으로 바꿔준다 
df[&#39;school_addr_town&#39;] = df[&#39;school_addr_town&#39;].apply(lambda x: x.replace(&#39;로&#39;,&#39;동&#39;))</code></pre>
</div>
<div id="null값-확인" class="section level5">
<h5>2)null값 확인</h5>
<pre class="python"><code>df.isnull().any()</code></pre>
<ul>
<li>학교 학생수에 null값 발생</li>
</ul>
<pre class="python"><code>df = df.fillna(0)</code></pre>
</div>
<div id="이상치-제거" class="section level5">
<h5>3)이상치 제거</h5>
<ul>
<li>실거래가를 자치구별로 나타내고 이상치 제거</li>
</ul>
<pre class="python"><code>figure,ax1 = plt.subplots()
figure.set_size_inches(18,5)

sns.boxplot(data=df,y=&#39;amount&#39;,x=&#39;district_id&#39;)</code></pre>
<ul>
<li>이상치는 동일 면적의 해당 아파트 거래가 한번인 경우 제거하지 않았다</li>
<li>해당 아파트에 대한 거래 정보가 없어지기 때문</li>
</ul>
<pre class="python"><code>df.drop(df[df[&#39;district_id&#39;]==2].sort_values(by=&#39;amount&#39;,ascending=False).head(1).index,inplace=True)
df.drop(df[df[&#39;district_id&#39;]==6].sort_values(by=&#39;amount&#39;,ascending=False).head(1).index,inplace=True)
df.drop(df[df[&#39;district_id&#39;]==12].sort_values(by=&#39;amount&#39;,ascending=False).head(5).index,inplace=True)
#df.drop(df[df[&#39;district_id&#39;]==13].sort_values(by=&#39;amount&#39;,ascending=False).head(2).index,inplace=True) 거래가 총 2번 이루어져서 제거 안함
df.drop(df[df[&#39;district_id&#39;]==14].sort_values(by=&#39;amount&#39;,ascending=False).head(1).index,inplace=True)
df.drop(df[df[&#39;district_id&#39;]==16].sort_values(by=&#39;amount&#39;,ascending=False).head(1).index,inplace=True)
df.drop(df[df[&#39;district_id&#39;]==18].sort_values(by=&#39;amount&#39;,ascending=False).head(1).index,inplace=True)
df.drop(df[df[&#39;district_id&#39;]==19].sort_values(by=&#39;amount&#39;,ascending=False).head(1).index,inplace=True)
df.drop(df[df[&#39;district_id&#39;]==22].sort_values(by=&#39;amount&#39;,ascending=False).head(3).index,inplace=True)#신호아파트 면적97인 아파트의 경우 한번 거래가 이루어져 제거 안함
df.drop(df[df[&#39;district_id&#39;]==24].sort_values(by=&#39;amount&#39;,ascending=False).head(1).index,inplace=True)</code></pre>
<pre class="python"><code>#이상치를 제거한 boxplot
figure,ax1 = plt.subplots()
figure.set_size_inches(18,5)

sns.boxplot(data=df,y=&#39;amount&#39;,x=&#39;district_id&#39;)</code></pre>
</div>
</div>
<div id="feature-selecting-데이터-분석" class="section level4">
<h4>4. Feature selecting &amp; 데이터 분석</h4>
<ul>
<li>클러스터링에 사용할 변수를 선택하기 위해 각 변수와 amount의 상관관계 파악에 중점을 두어 분석</li>
<li>데이터의 분포와 값을 살펴보면서 데이터에 대한 이해 증진</li>
<li>변수는 크게 5가지로 나누어 살펴볼 것</li>
</ul>
<pre class="python"><code># 시계열에만 사용될 변수를 제거하고 heatmap을 사용해 상관관계를 살펴보았다
temp = df.drop([&#39;apartment_id&#39;,&#39;area&#39;,&#39;year&#39;,&#39;month&#39;],axis=1)
figure,ax1 = plt.subplots()
figure.set_size_inches(10,10)

sns.heatmap(temp.corr(),annot=True,cmap=&#39;YlGnBu&#39;)</code></pre>
<ul>
<li>수치상으로 ‘apartment_parking’ ‘school_students’ ’st_dist’변수가 상대적으로 amount값과 높은 상관관계를 보인다</li>
<li>각 변수별로 자세히 알아보자</li>
</ul>
<div id="연도별-거래액" class="section level5">
<h5>1) 연도별 거래액</h5>
<pre class="python"><code>#2020년도의 경우 6월달까지의 거래액만 존재해서 제외
a = df[df[&#39;year&#39;]&lt;2020]
figure,ax1 = plt.subplots()
figure.set_size_inches(18,6) 

sns.barplot(data=a,x=&quot;year&quot;,y=&quot;amount&quot;,ax=ax1)</code></pre>
<ul>
<li>2009년도부터 2013년까지의 실거래가가 감소하나, 2013년도부터 실거래가 증가</li>
</ul>
</div>
<div id="학교정보" class="section level5">
<h5>2) 학교정보</h5>
<pre class="python"><code>df[&#39;school_name&#39;].nunique()</code></pre>
<div id="school_id" class="section level6">
<h6>school_id</h6>
<ul>
<li>학교 id에 따른 2019년도 거래가를 구해서 분포를 살펴보았다</li>
</ul>
<pre class="python"><code>sample = df[df[&#39;school_students&#39;]&gt;0]
sample = sample.groupby([&#39;school_name&#39;,&#39;year&#39;])[&#39;amount&#39;].mean().reset_index()
sample_2019 = sample[sample[&#39;year&#39;]==2019]
sample_2019.head()</code></pre>
<pre class="python"><code>figure,(ax1,ax2) = plt.subplots(nrows=1,ncols=2)
figure.set_size_inches(18,6) 

sns.scatterplot(sample_2019[&#39;school_name&#39;],sample_2019[&#39;amount&#39;],ax=ax1)
sns.distplot(sample_2019[&#39;amount&#39;],ax=ax2,bins=100)</code></pre>
<ul>
<li>가격의 분포가 5억을 중심으로 정규분포에 근사하며, 학교에 따라 다양한 값을 가짐</li>
</ul>
</div>
<div id="학교-주소" class="section level6">
<h6>학교 주소</h6>
<pre class="python"><code>a = df[&#39;school_addr_district&#39;]==df[&#39;district_id&#39;]
a = pd.DataFrame(a)
sns.heatmap(a,cbar=False, cmap=&quot;YlGnBu&quot;)</code></pre>
<ul>
<li>‘school_add_district’와’district_id’ 값이 모두 동일하므로 제거한다</li>
</ul>
</div>
<div id="school_dist" class="section level6">
<h6>school_dist</h6>
<pre class="python"><code>df[&#39;school_dist&#39;].max()</code></pre>
<ul>
<li>아파트에서 가장 가까운 학교까지의 거리는 최대 도보 29분</li>
</ul>
<pre class="python"><code>figure,ax1 = plt.subplots()
figure.set_size_inches(12,6) 

sns.boxplot(x=&quot;school_dist&quot;,y=&quot;amount&quot;,data=df,color=&quot;m&quot;,ax=ax1)</code></pre>
<ul>
<li>아파트에서 학교까지의 거리에 따른 amount값이 큰 차이를 보이지 않는다. 특히 17분 이하의 경우에는 거의 동일한 box plot을 갖는다 – 제거</li>
<li>heatmap의 0.023 수치에서도 확인 가능</li>
</ul>
</div>
<div id="school_students" class="section level6">
<h6>school_Students</h6>
<pre class="python"><code>ind = df[df[&#39;school_name&#39;]==&#39;서울가산초등학교&#39;].index
temp = df.drop(ind)
# 서울가산초등학교의 경우 데이터에 따라 금천구 구로구에 모두 속한다고 표기되어 있음 제거해준다</code></pre>
<pre class="python"><code>temp = temp.groupby(&#39;school_name&#39;).mean()[[&#39;school_students&#39;,&#39;amount&#39;]].dropna()
temp = pd.merge(temp,df[[&#39;district_name&#39;,&#39;school_name&#39;]],how=&#39;left&#39;,on=&#39;school_name&#39;).drop_duplicates().reset_index()
temp.head()</code></pre>
<pre class="python"><code>sns.distplot(temp[&#39;school_students&#39;],bins=100)</code></pre>
<pre class="python"><code># 학교 학생수가 2000명이 넘는 학교는 한군데로 제거하고 분석을한다 
temp = temp[temp[&#39;school_students&#39;]&lt;2000]</code></pre>
<ul>
<li>자치구별 세대수와 학교 학생수의 비율을 구하고, 그 비율에 따른 amount값의 분포를 살펴보고자 한다</li>
</ul>
<pre class="python"><code># 각 자치구 별 세대수
population = pd.read_excel(&quot;population.xlsx&quot;)
population.drop([&#39;※ 매년 말일자 통계 현황&#39;,&#39;Unnamed: 4&#39;],axis=1,inplace=True)
population.drop([0,1,2],inplace=True)
population.rename(columns={&#39;Unnamed: 1&#39;:&#39;district_name&#39;,&#39;Unnamed: 2&#39;:&#39;총인구수&#39;,&#39;Unnamed: 3&#39;:&#39;세대수&#39;},inplace=True)
population[&#39;district_name&#39;] = population.district_name.str.split(&#39; &#39;).str[1]
population[&#39;세대수&#39;] = population.세대수.str.replace(&#39;,&#39;, &#39;&#39;).astype(&#39;int64&#39;)
population = population.drop(&#39;총인구수&#39;,axis=1)
population.head()</code></pre>
<pre class="python"><code>df1 = pd.merge(temp,population,how=&#39;left&#39;,on=&#39;district_name&#39;)
df1[&#39;ratio&#39;] = 0.0
for ind in df1.index:
  a = float(df1[&#39;세대수&#39;][ind])
  b = float(df1[&#39;school_students&#39;][ind])
  df1[&#39;ratio&#39;][ind] = b/a</code></pre>
<pre class="python"><code>sns.distplot(df1[&#39;ratio&#39;],bins=100)</code></pre>
<ul>
<li>ratio는 0.00038과 0.015사이</li>
<li>ratio가 0.015이상인 학교는 한 사례로 제거한다</li>
</ul>
<pre class="python"><code>df1 = df1[df1[&#39;ratio&#39;]&lt;0.015]</code></pre>
<pre class="python"><code>figure,ax1 = plt.subplots()
figure.set_size_inches(6,6) 

sns.regplot(x=&quot;ratio&quot;,y=&quot;amount&quot;,data=df1,color=&quot;m&quot;,ax=ax1)</code></pre>
<ul>
<li>ratio가 클수록 아파트의 실거래가가 높아진다</li>
<li>ratio를 구간별로 나누어 실거래가와의 관계를 살펴본다</li>
</ul>
<pre class="python"><code>factor = pd.cut(df1.ratio,5)
a = df1.amount.groupby(factor).mean()
a = pd.DataFrame(a)
a = a.reset_index()


figure,ax1 = plt.subplots()
figure.set_size_inches(18,5) 

sns.barplot(data=a,x=&quot;ratio&quot;,y=&quot;amount&quot;,ax=ax1)</code></pre>
<ul>
<li>자치구 세대수 인구 대비 학교 학생수의 비율이 커질수록, amount가 커지는 경향</li>
</ul>
</div>
</div>
<div id="세대당-주차대수" class="section level5">
<h5>3) 세대당 주차대수</h5>
<pre class="python"><code>figure,ax1 = plt.subplots()
figure.set_size_inches(18,6) 
sns.distplot(df[&#39;apartment_parking&#39;],ax=ax1,bins=60)</code></pre>
<ul>
<li>세대당 주차대수는 0~2대 사이에 주로 분포</li>
</ul>
<pre class="python"><code>figure,ax1 = plt.subplots()
figure.set_size_inches(18,5) 

sns.barplot(data=df,x=&quot;apartment_parking&quot;,y=&quot;amount&quot;,ax=ax1)</code></pre>
<ul>
<li>세대당 주차대수의 값이 커질수록 amount의 값이 점진적으로 우상향하는 것을 확인할 수 있다</li>
</ul>
</div>
<div id="건설" class="section level5">
<h5>4) 건설</h5>
<pre class="python"><code>df[&#39;apartment_builder&#39;].nunique()</code></pre>
<ul>
<li>2520개의 건설사 존재</li>
</ul>
<div id="apartment_builder" class="section level6">
<h6>apartment_Builder</h6>
<ul>
<li>건설사에 따른 2019년도의 거래가를 구해서 거래가의 분포를 살펴보았다</li>
</ul>
<pre class="python"><code>sample = df.groupby([&#39;apartment_builder&#39;,&#39;year&#39;])[&#39;amount&#39;].mean().reset_index()
sample_2019 = sample[sample[&#39;year&#39;]==2019]
sample_2019.head()</code></pre>
<pre class="python"><code>figure,(ax1,ax2) = plt.subplots(nrows=1,ncols=2)
figure.set_size_inches(18,6) 

sns.scatterplot(sample_2019[&#39;apartment_builder&#39;],sample_2019[&#39;amount&#39;],ax=ax1)
sns.distplot(sample_2019[&#39;amount&#39;],ax=ax2,bins=200)</code></pre>
<ul>
<li>건설사별 2019년 아파트 평균 가격을 구하였을 때, 10억 이하의 값으로 편중되어있다 &gt; 제거한다</li>
</ul>
</div>
<div id="apartment_build_year" class="section level6">
<h6>apartment_build_year</h6>
<pre class="python"><code>figure,ax1 = plt.subplots()
figure.set_size_inches(18,5) 

sns.pointplot(data=df,x=&quot;apartment_build_year&quot;,y=&quot;amount&quot;,ax=ax1)</code></pre>
<ul>
<li>일의자리수를 제거하고 연도별 분석</li>
</ul>
<pre class="python"><code>df[&#39;apartment_build_year&#39;] = df[&#39;apartment_build_year&#39;].apply(lambda x : x - x%10)
a = df[&#39;apartment_build_year&#39;].value_counts()
a = pd.DataFrame(a)
a.reset_index(inplace=True)
a.rename(columns={&#39;index&#39;:&#39;apartment_build_year&#39;,&#39;apartment_build_year&#39;:&#39;count&#39;},inplace=True)


figure,(ax1,ax2) = plt.subplots(nrows=1,ncols=2)
figure.set_size_inches(18,6) 

sns.barplot(data=df,x=&quot;apartment_build_year&quot;,y=&quot;amount&quot;,ax=ax1)
sns.barplot(data=a,x=&quot;apartment_build_year&quot;,y=&quot;count&quot;,ax=ax2)</code></pre>
<ul>
<li>1970, 2020년대에 지어진 아파트의 수가 적은거에 비해 amount의 평균이 높다</li>
<li>2000년대에 가장 많이 아파트가 지어졌지만, 그에 비해 amount의 평균이 낮음</li>
</ul>
</div>
</div>
<div id="지하철역" class="section level5">
<h5>5) 지하철역</h5>
<pre class="python"><code>df[&#39;st_name&#39;].nunique()</code></pre>
<div id="st_name" class="section level6">
<h6>st_name</h6>
<ul>
<li>지하철역에 따른 2019년도의 거래가를 구해서 거래가의 분포를 살펴보았다</li>
</ul>
<pre class="python"><code>sample = df.groupby([&#39;st_name&#39;,&#39;year&#39;])[&#39;amount&#39;].mean().reset_index()
sample_2019 = sample[sample[&#39;year&#39;]==2019]
sample_2019.head()</code></pre>
<pre class="python"><code>figure,(ax1,ax2) = plt.subplots(nrows=1,ncols=2)
figure.set_size_inches(18,6)

sns.scatterplot(sample_2019[&#39;st_name&#39;],sample_2019[&#39;amount&#39;],ax=ax1)
sns.distplot(sample_2019[&#39;amount&#39;],ax=ax2,bins=100)</code></pre>
<ul>
<li>각 지하철역 근처 아파트의 2019년 거래가 평균을 살펴보았을 때, 가격의 분포가 역에 따라 다양한 값을 갖는다</li>
</ul>
</div>
<div id="st_volume" class="section level6">
<h6>st_volume</h6>
<pre class="python"><code>figure,(ax1,ax2) = plt.subplots(nrows=2,ncols=1)
figure.set_size_inches(18,10) 

sns.barplot(data=df,y=&#39;amount&#39;,x=&#39;st_volume&#39;,ax=ax1)
sns.pointplot(data=df,y=&#39;amount&#39;,x=&#39;year&#39;,hue=&#39;st_volume&#39;,ax=ax2)</code></pre>
<ul>
<li>환승역이 4개인 곳의 실거래가가 2014년도 이후부터 꾸준히 증가</li>
<li>환승역의 개수 별 거래액이 큰 차이를 보이지 않는다 &gt; 제거</li>
</ul>
</div>
<div id="st_dist" class="section level6">
<h6>st_dist</h6>
<pre class="python"><code>a = df.groupby(&#39;st_dist&#39;).mean()[&#39;amount&#39;]
a = pd.DataFrame(a).reset_index()

figure,ax1 = plt.subplots()
figure.set_size_inches(10,10) 

sns.regplot(x=&quot;st_dist&quot;,y=&quot;amount&quot;,data=a,color=&quot;m&quot;,ax=ax1)</code></pre>
<ul>
<li>가까운 역까지의 거리와 거래액은 음의 상관관계를 보인다</li>
<li>이번에는 거리를 구간별로 나눠서 살펴보자</li>
</ul>
<pre class="python"><code>factor = pd.cut(df.st_dist,7)
a = df.amount.groupby(factor).mean()
a = pd.DataFrame(a)
a = a.reset_index()

figure,ax1 = plt.subplots()
figure.set_size_inches(18,5) 

sns.barplot(data=a,x=&quot;st_dist&quot;,y=&quot;amount&quot;,ax=ax1)</code></pre>
<ul>
<li>거리가 0.0247 이하인 경우 지하철역에서 거리가 가까울수록 거래가가 비싸지만, 0.0247보다 큰 경우에는 양의 상관관계를 보인다</li>
<li>지하철역과 거리가 가장 먼 곳이 가장 높은 평균 거래가를 갖는다</li>
</ul>
<pre class="python"><code>df[df[&#39;st_dist&#39;]&gt;0.0296][&#39;apartment_addr_town&#39;].drop_duplicates()</code></pre>
<ul>
<li>지하철역과의 거리가 0.0296보다 큰 지역을 살펴보니, 평창동임을 확인할 수 있었다 &gt; 자가용을 이용하는 동네</li>
</ul>
</div>
<div id="feature-selecting" class="section level6">
<h6>Feature selecting</h6>
<ul>
<li>최종적으로 클러스터링에 ‘district_id’ ‘apartmnet_addr_town’ ‘apartment_build_year’ ‘apartment_parking’ ‘school_name’ ‘school_students’ ‘st_name’ ’st_dist’변수를 사용하기로 결정했다</li>
</ul>
</div>
</div>
</div>

    </div>
  </article>

  


</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="/index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with <img src="/images/hugo-logo.png" alt="Img link to Hugo website" width="22" height="22"></a>
          </li>
        </ul>
      </footer>

    </div>
    



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



    
<script src="/js/math-code.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    
  </body>
</html>

